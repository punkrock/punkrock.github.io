<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>punkrock.github.io</title>
  <meta name="description" content="Ressources for mining, forging and validating. Vote for punkrock!">
  <meta name="author" content="punkrock">

<!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->

<style type="text/css">
	body {font-family: Arial, Helvetica, sans-serif;}
  .highlighted-div { background-color: #ecffcb; width: auto; padding: 20px; display: inline-block }
	.inner-pre {font-size: 18px; font-family: Arial, Helvetica, sans-serif; font-weight: bold;}
  .nohigh {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }
  #update {
  background-color: #f0f0f0 ;
  padding: 10px ;
  border: 1px solid green ;
} 
</style>

</head>

<body>

  <pre>    ______  _   _  _   _  _   ________  _____  _____  _   __
    | ___ \| | | || \ | || | / /| ___ \|  _  |/  __ \| | / /
    | |_/ /| | | ||  \| || |/ / | |_/ /| | | || /  \/| |/ / 
    |  __/ | | | || . ` ||    \ |    / | | | || |    |    \ 
    | |    | |_| || |\  || |\  \| |\ \ \ \_/ /| \__/\| |\  \
    \_|     \___/ \_| \_/\_| \_/\_| \_| \___/  \____/\_| \_/
</pre>
<pre>---------------------------------------------------------------------------
<span class="inner-pre"><a href="https://punkrock.github.io">Home</a> | <a href="https://punkrock.github.io/lisk.html">Lisk</a></span>
---------------------------------------------------------------------------
</pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1><strong>Lisk v3 Mainnet on VPS with Ubuntu 20.04<br /><br /></strong></h1>

<h1>Summary</h1>
1. <a href="#step1">Create lisk user, install needed stuff</a><br>
2. <a href="#step2">Create your account</a><br>
3. <a href="#step3">Create a random 12-word passphrase and encrypt your account-passphrase</a><br>
4. <a href="#step4">Register your delegate and vote for yourself</a><br>
5. <a href="#step5">Start Lisk (if not running) and activate forging</a><br>
6. <a href="#update">How to update to a new version</a><br>
7. <a href="#step7">Switch to another forging node and activate forging</a><br><br><br><br>

<h3 id="step1">STEP 1 - Create lisk user, install needed stuff</h3>
<code><span class="nohigh">~# </span>adduser lisk<br />
<span class="nohigh">~# </span>gpasswd -a lisk sudo<br />
<span class="nohigh">~# </span>su - lisk<br /><br />
<span class="nohigh">~$ </span>sudo apt-get -y update &amp;&amp; sudo apt-get -y upgrade &amp;&amp; sudo apt-get -y dist-upgrade &amp;&amp; sudo apt-get -y install wget tar zip unzip ufw htop nano npm git curl bash jq screen<br />
<span class="nohigh">~$ </span>sudo apt install -y build-essential</br>
<span class="nohigh">~$ </span>wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh | bash<br /><br></code>
<b>Now disconnect from your server (close your sesssion) and start a new session.</b><br><br />
<code><span class="nohigh">~$ </span>nvm install 12<br />
<span class="nohigh">~$ </span>npm install --global --production lisk-core<br />
<span class="nohigh">~$ </span>npm i -g pm2<br></code><br>

<code><p><span class="nohigh">~$ </span> cd && nano core-start.json</code>
<br><br>
Copy paste this code into the file (it could be that the command lisk-core isn't found - see the INFO some lines below):
<div id="box">
    <pre>
{
  "name": "lisk-core",
  "script": "lisk-core start --api-ws -c ~/.lisk/lisk-core/config.json",
  "env": {
  "LISK_NETWORK": "mainnet"
  }
 }
</pre>
</div>

Save & Exit<br><br>




<h3 id="step2">STEP 2 - Create your account</h3>
<code><p><span class="nohigh">~$ </span>lisk-core account:create</p></code>
<blockquote>
<p><span style="color: #008000;"><sup>[ { "passphrase": "monkey ... ... ... ... ... ... ... ... ... ... image", "privateKey": "fc7d6bdf...4e51155a", "publicKey": "c50da2f4e489d33d22ffd26192eddff5ed9e6aa08c4d5a4794c62b034e51155a", "binaryAddress": "<span style="background-color: #ffcc99;">cf05384d5707179ea691731726313e83a00dc6f4</span>", "address": "<span style="background-color: #ccffcc;">lskajvtut6wzj5ah4ky7o5roo4fu7uzsywkawa94w</span>" } ]<br /></sup></span></p>
</blockquote>
<p><em>Store the output and don't lose it.<br /></em></p>
<p>&nbsp;</p>
<h3 id="step3">STEP 3 - Create a random 12-word passphrase and encrypt your account-passphrase</h3>
<code><p><span class="nohigh">~$ </span>lisk-core account:create</p></code>
<p><em>You just need the 12 words. Don't lose them!</em></p>
<blockquote>
<p><span style="color: #008000;"><sup>pitch ... ... ... ... ... ... ... ... ... ... unusual</sup></span></p>
</blockquote>
<code><p><span class="nohigh">~$ </span>lisk-core passphrase:encrypt</p></code>
<blockquote>
<p><span style="color: #008000;"><sup>Please enter passphrase: monkey ... ... ... ... ... ... ... ... ... ... image</sup></span><br /><span style="color: #008000;"><sup>Please re-enter passphrase: monkey ... ... ... ... ... ... ... ... ... ... image</sup></span><br /><span style="color: #008000;"><sup>Please enter password: pitch ... ... ... ... ... ... ... ... ... ... unusual</sup></span><br /><span style="color: #008000;"><sup>Please re-enter password: pitch ... ... ... ... ... ... ... ... ... ... unusual</sup></span></p>
</blockquote>
<p><em><br />Copy and paste the output into a txt-file. You'll need the highlighted part for the create_config.sh file blow:<br /></em></p>
<blockquote>
<p><sup><span style="color: #008000;">{"encryptedPassphrase":"<span style="background-color: #ff99cc;">iterations=100.......version=1</span>"}</span></sup></p>
</blockquote>
<p>&nbsp;</p>
<p>Now you create the onion hashes file:</p>
<code><p><span class="nohigh">~$ </span>cd ~ &amp;&amp; lisk-core hash-onion -o hash_onion.json</p></code><br>
<p>Now you create the path where Lisk will run and you create an empty config file:</p>
<code><span class="nohigh">~$ </span>cd && mkdir ~/.lisk && mkdir ~/.lisk/lisk-core && touch ~/.lisk/lisk-core/config.json
</code>
<code><span class="nohigh">~$ </span>cd ~ &amp;&amp; nano create_config.sh</p></code>

<p><br />Now you create a bash file:<br /><br />
<code><span class="nohigh">~$ </span>cd ~ &amp;&amp; nano create_config.sh</p></code>
<p>&nbsp;</p>
<p><em>Paste the following into the file and do <b>NOT</b> close it.<br>You need to replace "<b>binaryAddress</b>" with your binary address and you need to replace the "<b>iterations=100.........version=1</b>" stuff:</em></p>
<p></p>
<pre>

cd ~ && > ~/.lisk/lisk-core/config.json
ONION=$(cat ~/hash_onion.json)
cat > ~/.lisk/lisk-core/config.json << EOF_mainnet_config
{
"logger": {
"fileLogLevel": "error",
"consoleLogLevel": "info"
},
"plugins": {
"httpApi": {
"whiteList": [
"127.0.0.1"
]
}
},
"forging": {
"delegates": [
{
"address": "binaryAddress",
"encryptedPassphrase": "iterations=100............version=1",
"hashOnion": $ONION
}
]
}
}
EOF_mainnet_config
</pre>
<p></p>
<p><br /><em>Now remove the highlighted parts for address and encryptedPassphrase and replace them with the parts from the outputs you have generated above.<br /><br />Save and exit the create_config.sh file.<br /><br />Now you need to set the permissions to the file and execute it. This step will copy and paste the onion hashes into your config.json:<br /></em></p>
<code><p><span class="nohigh">~$ </span>chmod +x create_config.sh</p>
<p><span class="nohigh">~$ </span>./create_config.sh</p></code>
<p><br />Now you check if the config.json is working correct.</p>


Start Lisk Core:<br>
<code><p><span class="nohigh">~$ </span>cd && pm2 start core-start.json</code><br>
<br>Now check if Lisk Core is running:<br>
<code><span class="nohigh">~$ </span>pm2 list<br /></code><br>

If you see the PM2 status "errored", check the PM2 error logs:<br>
<code><span class="nohigh">~$ </span>pm2 logs<br /></code>


<br><br>
<strong><span style="color: #cc0000;">INFO:</span></strong> If your machine doesn't find the command lisk-core, then open ~./profile...
<code><p><span class="nohigh">~$ </span>nano ~/.profile<br></p></code>
...and add the following line to the end of the file, save and start a new session:<br>
<code><p>export PATH="$PATH:$HOME/.lisk/lisk-core/bin"<br><br><br></code>

  <code><span class="nohigh">~$ </span>pm2 logs</p></code>
<blockquote>
<p><sub><span style="color: #008000;">20:01:03 INFO lisk-framework: Starting the app - lisk-core (module=lisk:app)<br />20:01:03 INFO lisk-framework: If you experience any type of error, please open an issue on Lisk GitHub: https://github.com/LiskHQ/lisk-sdk/issues (module=lisk:app)<br />20:01:03 INFO lisk-framework: Contribution guidelines can be found at Lisk-sdk: https://github.com/LiskHQ/lisk-sdk/blob/development/docs/CONTRIBUTING.md (module=lisk:app)<br />20:01:03 INFO lisk-framework: Booting the application with Lisk Framework(3.0.0-beta.2.8362aa8) (module=lisk:app)<br />20:01:03 INFO lisk-framework: Initializing controller (module=lisk:app)<br />20:01:03 INFO lisk-framework: Loading controller (module=lisk:app)<br />20:01:03 INFO lisk-framework: Event * was subscribed but not registered to the bus yet. (module=lisk:app)<br />20:01:04 INFO lisk-framework: New block added to the chain (module=lisk:app)<br />{<br />"id": "5a92c178ca2125f358f61d2174fc5c5500f94ebf76da22165751cf3923003789",<br />"height": 0,<br />"numberOfTransactions": 0<br />} <br />20:01:04 INFO lisk-framework: Blockchain ready (module=lisk:app)<br />20:01:04 INFO lisk-framework: Node ready and launched (module=lisk:app)<br />20:01:07 INFO lisk-framework: Starting synchronizer (module=lisk:app)</span></sub></p>
</blockquote>
<p><em><br />If the output is like the one above, your config.json seems correct.<br /></em><em>If not, you have made mistakes when replacing the parts. Check again.<br> To detach from screen session correctly press CTRL+a+d<br /></em></p>
<p>&nbsp;</p>
<h3 id="step4">STEP 4 - Register your delegate and vote for yourself</h3>


<h4>Self-Voting from Mulit-Signature Account (Formerly known as "Second Passphrase"):</h4>

0. download lisk desktop: lisk.com/wallet
1. log in with your first passphrase<br />
2. wallet -> Add to votes<br />
3. Enter amount (10-LSK-steps!) and click confirm<br />
4. Click the voting queue icon at the top<br />
5. click "continue" and then click "download" and close the popup-window<br />
6. close the pop up window and sign out<br />
7. login with second passphrase<br />
8. in left menu click "sign multisignature" and click "read from JSON file"<br />
9. now chose the other JSON you just downloaded<br />
10. click "Review and sign" and in the next step "sign"<br />
11. click Send<br />
<br>
Now you should see "The transaction was broadcasted to the network. It will appear in sender account's wallet after confirmation."<br>
Voting from accounts with only one passphrase should be self-explanatory.<br>

<br /><br /><strong><span style="color: #cc0000;">IMPORTANT: You can only use an amount in 10-LSK-steps! 10066 LSK not allowed. Only 10060 or 10070 for example.<br>And the amounts for fees and voting weight have to be entered in Beddows. 10060 LSK = 1006000000000 Beddows</span></strong></em><br /><br /></p>
</blockquote>
<h3 id="step5">STEP 5 - Start Lisk (if not running) and activate forging</h3>
<p>Check if Lisk is running. If "pm2 list" or "pm2 status" shows "stopped" or "errored", start it again with the following command:</p>
<code><p><span class="nohigh">~$ </span>pm2 start core-start.json<br /></p></code>

<code>
  <p><span class="nohigh">~$ </span>cd ~<br>
  <p><span class="nohigh">~$ </span>curl https://raw.githubusercontent.com/Gr33nDrag0n69/LiskCore3Tools/main/SH/lisk-forging-enable.sh -o ~/lisk-forge-enable.sh<br>
  <p><span class="nohigh">~$ </span>chmod 700 ~/lisk-forge-enable.sh<br>
  <p><span class="nohigh">~$ </span>./lisk-forge-enable.sh<br>
  </code>
  <br>
  <blockquote>
<sup><span style="color: #008000;">Enable Forging on punkrocker?y<br />
lisk-core forging:enable 8f6b8f41152871464d6f1d59b9f91d2f1791cc69 14219835 14219764 14219764<br />
? Enter password to decrypt the encrypted passphrase:  *****************************************************************************<br />
Forging status:<br />
{"address":"8f6b8f41152871464d6f1d59b9f91d2f1791cc69","forging":true}<br /></span></sup>
</blockquote><br>
<p>If the output says "forging":true, congratulations. You should forge on Mainnet.<br /><br />To confirm you can always use lisk-core account:get <span style="background-color: #ffcc99;">BinaryAddress</span> to see if your balanace is increasing. Or you check logs for forged blocks with cat ~/.lisk/lisk-core/logs/lisk.log | grep "Forged new block" or wait for forged blocks with tail -f ~/.lisk/lisk-core/logs/lisk.log | grep "Forged new block".<br><br>

  <div id="update">
    <h1>STEP 6 - How to update to a new version</h1>
    The stuff in this gray box is needed to update your mainnet nodes:
    <code><p><span class="nohigh">~$ </span>npm update -g lisk-core</code>
    <br>
  <p><b>If you get warnings about npm and/or nvm, try this:</b></p>
<code><p><span class="nohigh">~$ </span>nvm install 12.22.3
    <p><span class="nohigh">~$ </span>npm install -g npm<br><br><br></code>
    <p><b>Now restart your node:</b></p>
  <code><p><span class="nohigh">~$ </span>pm2 restart all<br /></p></code>
    <br>
    <p><em>If your machine doesn't find the command lisk-core, then add the following entry to your ~./profile:</em></p>
    <code><p><span class="nohigh">~$ </span>nano ~/.profile<br><br></code>
      Put the following line to the end of the file, save and start a new session:<br>
  <code><p>export PATH="$PATH:$HOME/.lisk/lisk-core/bin"<br><br><br></code>
    <p><b>Now enable forging</b></p>
<code>
<p><span class="nohigh">~$ </span>./lisk-forge-enable.sh<br>
</code>
<br>
  <blockquote>
<sup><span style="color: #008000;">Enable Forging on punkrocker?y<br />
lisk-core forging:enable 8f6b8f41152871464d6f1d59b9f91d2f1791cc69 14219835 14219764 14219764<br />
? Enter password to decrypt the encrypted passphrase:  *****************************************************************************<br />
Forging status:<br />
{"address":"8f6b8f41152871464d6f1d59b9f91d2f1791cc69","forging":true}<br /></span></sup>
</blockquote><br>
</div> 
<br><br><br><br>

<h3 id="step7">STEP 7 - Switch to another forging node and activate forging</h3>
<span style="color: #cc0000;"><h1>!!! DANGER ZONE !!!</h1></span>
<img src="./dangerzone.jpg"><br><br>

<span style="color: #cc0000;"><b>WARNING! Read carefully!</b><br>
You are using this guide on your own risk!<br>
Mistakes when enabling forging with wrong numbers or wrong order can lead to a ban and lock up your locked LSK up to 780,000 blocks (minimum 90 days!).<br><br><br></span>


<b>On your current forging node you do this:</b>
<p><span class="nohigh">~$ </span>lisk-core forging:status<br />
<blockquote>
<sup><span style="color: #008000;">
[{"address":"8f6b8f41152871464d6f1d59b9f91d2f1791cc69","forging":true,"height":14396145,"maxHeightPrevoted":14396056,"maxHeightPreviouslyForged":14396074}]
</span></sup>
</blockquote>
<span style="color: #cc0000;"><b>Notice:</b></span><br>
Sometimes the output is: "height", "maxHeightPrevoted", "maxHeightPreviouslyForged"<br>
Another time it can be: "height", "maxHeightPreviouslyForged", "maxHeightPrevoted"<br>
You always have to use the order "height", "maxHeightPreviouslyForged", "maxHeightPrevoted" on your new node!<br><br>

Now stop your node:
<p><span class="nohigh">~$ </span>pm2 delete all<br /><br>


<span style="color: #cc0000;"><b>Notice:</b></span> Make 100% sure you are not forging anymore on this server or you can get banned for double forging!<br>

Now you copy the three numbers from above and bring them in this order: Height maxHeightPreviouslyForged maxHeightPrevoted.<br>
You always have to triple check the order, because above output can be different every time!<br><br>
<br>
<b>On your new forging node you do this:</b><br>

<p><span class="nohigh">~$ </span>lisk-core forging:enable 8f6b8f41152871464d6f1d59b9f91d2f1791cc69 <b>Height</b> maxHeight<b>Previously</b>Forged maxHeight<b>Prevoted</b> --overwrite<br /><br />
<span style="color: #cc0000;"><b>Notice:</b></span><br>
Use the correct order and don't forget the flag --overwrite or you get in trouble!<br><br>


<br><br><br>
<h3>Ressources</h3>
<a title="Lisk v3 Mainnet Explorer by moosty" href="https://liskscan.com/" target="_blank" rel="noopener">Lisk v3 Mainnet Explorer by moosty</a> or <a title="Lisk v3 Mainnet Explorer by Carbonara" href="https://lisk.observer/" target="_blank" rel="noopener">Lisk v3 Mainnet Explorer by Carbonara</a> 
<br>
Happy forging!<br /><br>punkrock</h2>
  </body>
</html>